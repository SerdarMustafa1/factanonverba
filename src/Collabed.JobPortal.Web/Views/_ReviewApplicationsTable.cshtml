@using Collabed.JobPortal.Web.Models;
@using Collabed.JobPortal.Types;
@model ApplicationModel

@{
    var totalPagesApplications = Model.Applications.Count > 0 ? (int)Math.Ceiling(decimal.Divide(Model.Applications.Count, Model.PageSize)) : 0;
}
<div class="tab-pane active" id="allApplications">
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th style="width: 20%" scope="Column">Candidate</th>
                    <th style="width: 20%" scope="Column">Applied</th>
                    <th style="width: 20%" scope="Column">Rating</th>
                    <th style="width: 20%" scope="Column">Status</th>
                    <th style="width: 20%" scope="Column" colspan="2">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var application in Model.Applications)
                {
                    <tr id="@application.JobApplicationId">
                        <td scope="Row"><a class="edit-link" href="~/applicant?reference=@application.Reference">@application.CandidateName</a></td>
                        <td>@application.ApplicationDate.ToString("dd/MM/yyyy")</td>
                        <td>
                            <div class="form-group" style="width: 50%;">
                                @Html.DropDownListFor(c => application.Rating, Model.Ratings, " - ", new { id = $"rating{application.Reference}", @class = "form-select", data_live_search = "true", onchange = $"updateApplicantRating('{application.Reference}')" })
                            </div>
                        </td>
                        <td id="@("status"+application.JobApplicationId)"> @application.GetTextStatus() </td>
                        <td><a id="@("next"+application.JobApplicationId)" class="edit-link" href="#" onclick="onPromote('@application.JobApplicationId')">Next stage</a></td>
                        <td><a id="@("reject"+application.JobApplicationId)" class="delete-link" href="#" onclick="onReject('@application.JobApplicationId')">Reject</a></td>
                    </tr>
                }
                @if (Model.Applications.Count == 0)
                {
                    <tr>
                        <td scope="Row" colspan="2" style="border-bottom-width: 0">No applications submitted.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <div class="clientsPaginationContainer">
        <ul class="pagination">
            @if (Model.CurrentPage > 1)
            {
                var link = $"?Reference={Model.Reference}&CurrentPage={Model.CurrentPage - 1}&Tab={Model.Tab}";
                <li class="page-item">
                    <a href=@link class="page-link">
                        <i class="bi bi-chevron-left"></i>
                    </a>
                </li>
            }

            @for (var i = 1; i <= totalPagesApplications; i++)
            {
                var shouldDisplayPage = i == 1 || i == totalPagesApplications ||
                (i >= Model.CurrentPage - 2 && i <= Model.CurrentPage + 2);
                var isEllipsisBefore = i == Model.CurrentPage - 3;
                var isEllipsisAfter = i == Model.CurrentPage + 3;

                if (shouldDisplayPage || isEllipsisBefore || isEllipsisAfter)
                {
                    var link = $"?Reference={Model.Reference}&CurrentPage={i}&Tab={Model.Tab}";

                    if (isEllipsisBefore || isEllipsisAfter)
                    {
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    }
                    else
                    {
                        <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                            <a href=@link class="page-link">@i</a>
                        </li>
                    }
                }
            }
            @if (Model.CurrentPage < totalPagesApplications)
            {
                var link = $"?Reference={Model.Reference}&CurrentPage={Model.CurrentPage + 1}&Tab={Model.Tab}";
                <li class="page-item">
                    <a href=@link class="page-link">
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </li>
            }
        </ul>
    </div>
</div>