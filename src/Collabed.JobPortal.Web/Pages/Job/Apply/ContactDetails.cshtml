@page
@model Collabed.JobPortal.Web.Pages.Job.Apply.ContactDetailsModel

@section styles{
    <abp-style src="/apply-pages.css"></abp-style>
}

@{
    var previousPage = $"../../Job?Reference={Model.JobDto.Reference}";
    TempData["BackToJobOfferParams"] = previousPage;
    var buttonTitle = Model.CurrentStep >= Model.StepsRequired ? "Submit" : "Continue";
    var isLoggedIn = TempData.Peek("UserId") != null ? true : false;
}
<div class="row no-display-on-mobile">
    <div class="col-4"></div>
    <div class="col-4">
        <div style="text-align:left;">
            <p class="text-36" style="margin-top:4%">@TempData.Peek("Title")</p>
            <p>
                <span style="color: #101828; font-size: 16px; font-weight: 400; line-height: 24px;">
                    Posted by @TempData.Peek("OrganisationName")
                </span>
                <span style="color: #667085; font-weight: 400; font-size: 16px; line-height:24px;">
                    on @DateTime.Parse(TempData.Peek("PublishedDate")?.ToString()).ToString("dd/MM/yyyy")
                </span>
            </p>
            <p class="text-16-bold">
                @if (!string.IsNullOrWhiteSpace(TempData.Peek("EmploymentType")?.ToString()))
                {
                    @TempData.Peek("EmploymentType")
                    @if (!string.IsNullOrWhiteSpace(TempData.Peek("ContractType")?.ToString()) || !string.IsNullOrWhiteSpace(TempData.Peek("SalaryRange")?.ToString()) ||
                   !string.IsNullOrWhiteSpace(TempData.Peek("OfficeLocation")?.ToString()) || !string.IsNullOrWhiteSpace(TempData.Peek("JobLocation")?.ToString()))
                    {
                        <i class="bi bi-dot" style="color:#2F70B6;"></i>
                    }
                }
                @if (!string.IsNullOrWhiteSpace(TempData.Peek("ContractType")?.ToString()))
                {
                    @TempData.Peek("ContractType")
                    @if (!string.IsNullOrWhiteSpace(TempData.Peek("SalaryRange")?.ToString()) ||
                   !string.IsNullOrWhiteSpace(TempData.Peek("OfficeLocation")?.ToString()) || !string.IsNullOrWhiteSpace(TempData.Peek("JobLocation")?.ToString()))
                    {
                        <i class="bi bi-dot" style="color:#2F70B6;"></i>
                    }
                }
                @if (!string.IsNullOrEmpty(TempData.Peek("SalaryRange").ToString()))
                {
                    @TempData.Peek("SalaryRange")
                    @if (!string.IsNullOrWhiteSpace(TempData.Peek("OfficeLocation")?.ToString()) || !string.IsNullOrWhiteSpace(TempData.Peek("JobLocation")?.ToString()))
                    {
                        <i class="bi bi-dot" style="color:#2F70B6;"></i>
                    }
                }
                @if (!string.IsNullOrEmpty(TempData.Peek("OfficeLocation")?.ToString()))
                {
                    @TempData["OfficeLocation"]
                    @if (!string.IsNullOrWhiteSpace(TempData.Peek("JobLocation")?.ToString()))
                    {
                        <i class="bi bi-dot" style="color:#2F70B6;"></i>
                    }
                }
                @if (!string.IsNullOrWhiteSpace(TempData.Peek("JobLocation")?.ToString()))
                {
                    @TempData.Peek("JobLocation")
                }
            </p>
            <p><a href=@previousPage class="back-link"><i class="bi bi-arrow-left back-arrow"></i>Back to job description</a></p>
        </div>
    </div>
    <div class="col-4"></div>
</div>
<div class="row display-on-mobile">
    <div style="text-align:left;">
        <p class="text-36" style="margin-top:4%">@TempData.Peek("Title")</p>
        <p>
            <span style="color: #101828; font-size: 16px; font-weight: 400; line-height: 24px;">
                Posted by @TempData.Peek("OrganisationName")
            </span>
            <span style="color: #667085; font-weight: 400; font-size: 16px; line-height:24px;">
                on @DateTime.Parse(TempData.Peek("PublishedDate")?.ToString()).ToString("dd/MM/yyyy")
            </span>
        </p>
        <p class="text-16-bold no-display-on-mobile">
            @if (!string.IsNullOrWhiteSpace(TempData.Peek("EmploymentType")?.ToString()))
            {
                @TempData.Peek("EmploymentType")
                @if (!string.IsNullOrWhiteSpace(TempData.Peek("ContractType")?.ToString()) || !string.IsNullOrWhiteSpace(TempData.Peek("SalaryRange")?.ToString()) ||
               !string.IsNullOrWhiteSpace(TempData.Peek("OfficeLocation")?.ToString()) || !string.IsNullOrWhiteSpace(TempData.Peek("JobLocation")?.ToString()))
                {
                    <i class="bi bi-dot" style="color:#2F70B6;"></i>
                }
            }
            @if (!string.IsNullOrWhiteSpace(TempData.Peek("ContractType")?.ToString()))
            {
                @TempData.Peek("ContractType")
                @if (!string.IsNullOrWhiteSpace(TempData.Peek("SalaryRange")?.ToString()) ||
               !string.IsNullOrWhiteSpace(TempData.Peek("OfficeLocation")?.ToString()) || !string.IsNullOrWhiteSpace(TempData.Peek("JobLocation")?.ToString()))
                {
                    <i class="bi bi-dot" style="color:#2F70B6;"></i>
                }
            }
            @if (!string.IsNullOrEmpty(TempData.Peek("SalaryRange").ToString()))
            {
                @TempData.Peek("SalaryRange")
                @if (!string.IsNullOrWhiteSpace(TempData.Peek("OfficeLocation")?.ToString()) || !string.IsNullOrWhiteSpace(TempData.Peek("JobLocation")?.ToString()))
                {
                    <i class="bi bi-dot" style="color:#2F70B6;"></i>
                }
            }
            @if (!string.IsNullOrEmpty(TempData.Peek("OfficeLocation")?.ToString()))
            {
                @TempData.Peek("OfficeLocation")
                @if (!string.IsNullOrWhiteSpace(TempData.Peek("JobLocation")?.ToString()))
                {
                    <i class="bi bi-dot" style="color:#2F70B6;"></i>
                }
            }
            @if (!string.IsNullOrWhiteSpace(TempData.Peek("JobLocation")?.ToString()))
            {
                @TempData.Peek("JobLocation")
            }
        </p>
        <p><a href=@previousPage class="back-link"><i class="bi bi-arrow-left back-arrow"></i>Back to job description</a></p>
    </div>
</div>
<hr class="divider" />
@if (isLoggedIn)
{
    <div class="alert alert-warning alert-dismissible fade show bmt-warning-alert" role="alert">
        <i class="bi bi-exclamation-triangle-fill" style="margin-right:1%;"></i>Your profile will also be updated with this contact information.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

}
<div class="progress">
    <div class="progress-bar" role="progressbar" style="width: @Model.ProgressBarValue%;background-color: #2F70B6;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
    <span class="progress-text">@Model.ProgressBarValue%</span>
</div>
<form method="post">
    <div style="max-width:400px;margin-inline:auto;">
        <p class="text-30">Contact Details</p>
        <p class="text-16">Please check your details carefully to make sure the hiring company can reach you</p>
        <div class="row">
            <div class="col-6">
                <label asp-for="FirstName" class="form-label">First Name <span style="color:#DC3545;">*</span></label>
                <input asp-for="FirstName" required class="form-control" />
                <span asp-validation-for="FirstName"></span>
            </div>
            <div class="col-6">
                <label asp-for="LastName" class="form-label">Last Name <span style="color:#DC3545;">*</span></label>
                <input asp-for="LastName" required class="form-control" />
                <span asp-validation-for="LastName"></span>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <label asp-for="EmailAddress" class="form-label">Email Address <span style="color:#DC3545;">*</span></label>
                <input asp-for="EmailAddress" required class="form-control" />
                <span asp-validation-for="EmailAddress"></span>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <label asp-for="PhoneNumber" class="form-label">Phone number <span style="color:#DC3545;">*</span></label>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="phone">+44</span>
                    </div>
                    <input asp-for="PhoneNumber" required class="form-control" />
                </div>
                <span class="hint">Please enter a UK mobile number</span><br />
                <span asp-validation-for="PhoneNumber"></span>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <label asp-for="PostCode" class="form-label">Postcode</label>

                <input asp-for="PostCode" class="form-control" style="text-transform:uppercase" aria-describedby="phone" />
                <span class="hint">Please enter your postcode</span><br />
            </div>
        </div>
    </div>
    <div style="text-align:center; margin-top:2%;">
        <input asp-for="UpdatedStepValue" class="form-control" type="hidden" id="updatedStepValue" name="UpdatedStepValue">
        <button class="btn btn-primary submit-btn" type="button" onclick="submitForm()">@buttonTitle</button>
    </div>
</form>

<script type="text/javascript">
    //TODO - MOVE SCRIPTS IN ANOTHER FILE
function submitForm() {
    var step = parseInt(@Model.CurrentStep);
    var nextStep = step + 1;
   document.getElementById("updatedStepValue").value = step+1;
   localStorage.setItem("updatedStepValue", nextStep);
  document.querySelector("form").submit(); // Submit the form programmatically
}

window.onpopstate = function() {
    document.getElementById("updatedStepValue").value = 1;
    localStorage.setItem("updatedStepValue", 1);
}
</script>
